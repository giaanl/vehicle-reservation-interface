<div class="profile-container">
  <app-header (logout)="logout()"></app-header>

  <div class="main-content">
    <button class="back-button" (click)="goBack()">
      <ng-icon name="heroChevronLeft" />
      Voltar
    </button>

    <div class="profile-content">
      <h1 class="page-title">Editar Perfil</h1>

      <form
        [formGroup]="profileForm"
        (ngSubmit)="onSubmit()"
        class="profile-form"
      >
        <div class="avatar-section">
          <div class="avatar-circle">
            <ng-icon name="heroUser" />
          </div>
        </div>

        <div class="form-group">
          <label for="name">Nome completo</label>
          <input
            id="name"
            type="text"
            formControlName="name"
            placeholder="Digite seu nome"
            [class.error]="nameError"
          />
          @if (nameError) {
            <span class="error-message">{{ nameError }}</span>
          }
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="Digite seu email"
            [class.error]="emailError"
          />
          @if (emailError) {
            <span class="error-message">{{ emailError }}</span>
          }
        </div>

        <div class="password-section">
          <button
            type="button"
            class="toggle-password-btn"
            (click)="togglePasswordFields()"
          >
            <ng-icon name="heroKey" />
            {{
              showPasswordFields()
                ? "Cancelar alteração de senha"
                : "Alterar senha"
            }}
          </button>

          @if (showPasswordFields()) {
            <div class="password-fields">
              <div class="form-group">
                <label for="currentPassword">Senha atual</label>
                <input
                  id="currentPassword"
                  type="password"
                  formControlName="currentPassword"
                  placeholder="Digite sua senha atual"
                />
              </div>

              <div class="form-group">
                <label for="newPassword">Nova senha</label>
                <input
                  id="newPassword"
                  type="password"
                  formControlName="newPassword"
                  placeholder="Digite sua nova senha"
                  [class.error]="passwordError"
                />
              </div>

              <div class="form-group">
                <label for="confirmPassword">Confirmar nova senha</label>
                <input
                  id="confirmPassword"
                  type="password"
                  formControlName="confirmPassword"
                  placeholder="Confirme sua nova senha"
                  [class.error]="passwordError"
                />
                @if (passwordError) {
                  <span class="error-message">{{ passwordError }}</span>
                }
              </div>
            </div>
          }
        </div>

        @if (errorMessage()) {
          <div class="server-error">
            {{ errorMessage() }}
          </div>
        }

        @if (successMessage()) {
          <div class="success-message">
            {{ successMessage() }}
          </div>
        }

        <button
          type="submit"
          class="save-button"
          [disabled]="profileForm.invalid"
        >
          Salvar alterações
        </button>

        <a class="delete-link" (click)="openDeleteModal()">
          <ng-icon name="heroTrash" />
          Excluir conta
        </a>
      </form>
    </div>
  </div>
</div>

<app-confirm-modal
  [show]="showDeleteModal()"
  title="Excluir conta"
  message="Tem certeza que deseja excluir sua conta? 
  Esta ação é irreversível e todos os seus dados serão 
  permanentemente removidos."
  confirmText="Sim, excluir conta"
  cancelText="Cancelar"
  type="danger"
  (confirm)="confirmDelete()"
  (cancel)="closeDeleteModal()"
/>
